<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">

  // Load the Visualization API and the piechart package.
  google.load('visualization', '1.0', {'packages':['corechart']});

  // Set a callback to run when the Google Visualization API is loaded.
  google.setOnLoadCallback(drawChart);


  // Callback that creates and populates a data table,
  // instantiates the pie chart, passes in the data and
  // draws it.
  function drawChart() {

  // Create the data table.
  var data = new google.visualization.DataTable();
  data.addColumn('string', 'Hours');
  data.addColumn('number', 'Effective');
  data.addRows([
    ['Travel (<%= @service_order.travel_hours %>)', <%= @service_order.travel_hours %>],
    ['Straight (<%= @service_order.straight_hours %>)', <%= @service_order.straight_hours %>],
    ['OT (<%= @service_order.overtime_hours %>)', <%= @service_order.overtime_hours * 1.5 %>],
    ['DT (<%= @service_order.doubletime_hours %>)', <%= @service_order.doubletime_hours * 2 %>],
    ['Remaining (<%= @service_order.remaining_hours %>)', <%= @service_order.remaining_hours >= 0 ? @service_order.remaining_hours : 0 %>]
  ]);

  // Set chart options
  var options = {
                  chartArea: { left: 0, top: 6, width: 320},
                  is3D: true,
                  pieSliceText: 'value',
                  legend: { position: 'left', textStyle: { fontSize: 12} },
                  colors: ['green', '#00FFFF', 'blue', 'purple', 'red']
                };

  // Instantiate and draw our chart, passing in some options.
  var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
  chart.draw(data, options);
}
</script>

<section id="service-order-summary">
  <div class="page-header">
    <h3>
      Service Order #<%= @service_order.number %>
      <% if @service_order.completed? %>
        (Complete)
      <% end %>
      <span class="label label-inverse">
        <%= @service_order.category.name %>
      </span>
    </h3>
  </div>

  <% if @service_order.completed? %>
    <%= link_to 'Re-open', service_order_url(@service_order, "service_order[completed]" => false), method: 'put', class: 'btn btn-success' %>
  <% else %>
    <%= link_to 'Complete', service_order_url(@service_order, "service_order[completed]" => true), method: 'put', class: 'btn btn-success' %>
  <% end %>
  <%= link_to 'Edit', edit_service_order_path(@service_order), class: 'btn btn-warning' %>
  <%= link_to 'Destroy', @service_order, class: 'btn btn-danger', method: :delete, data: { confirm: 'Are you sure?' } %>

  <p class="lead" style="margin: 15px 0">
    <%= @service_order.description %>
  </p>

  <dl class="dl-horizontal">
    <dt>Budgeted Hours</dt>
    <dd><%= @service_order.budget %></dd>
    <dt>Total Hours</dt>
    <dd><%= @service_order.total_hours %></dd>
  </dl>
  <div id="chart_div" style="width:400; height:300"></div>
</section>

<section id="service-order-confirmations">
  <%= link_to "Add Confirmation", new_confirmation_url(service_order_id: @service_order.id), class: 'btn btn-large btn-success' %>
  <div class="page-header">
    <h3>Confirmations</h3>
  </div>

  <table class="table table-striped table-hover">
    <tr>
      <th>Number</th>
      <th>Performed</th>
      <th>Total Hours</th>
      <th>Description</th>
    </tr>

  <% @service_order.confirmations.order("performed_on DESC").each do |confirmation| %>
    <tr>
      <td><%= link_to confirmation.number, confirmation, class: 'btn btn-primary btn-block' %></td>
      <td><%= confirmation.performed_on.strftime("%a, %b %e, %Y") %></td>
      <td><%= confirmation.total_hours %></td>
      <td><%= confirmation.description %></td>
    </tr>
  <% end %>
  </table>
</section>
